<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>Ch2Ex1 Displaying Text</title>
	
	<style type="text/css" media="screen">
		.page-container {
			position:absolute;
			top:50px;
			left:50px;
		}

		#canvasOne {
			background-color: #CCCCCC;
		}

		.label {
			width: 150px;
			display: inline-block;
			margin-bottom: 10px;
		}

		.wrapper {
			display: table-cell;
			padding: 20px;
		}
	</style>

	<script src="../_libs/modernizr.js" type="text/javascript" charset="utf-8" async defer></script>
	<script src="../_libs/jscolor/jscolor.js" type="text/javascript" charset="utf-8" async defer></script>
	<script type="text/javascript">
	
		window.addEventListener("load", eventWindowLoaded, false);

		function eventWindowLoaded() {
			var patternImage = new Image();
			patternImage.src = "texture.jpg";
			patternImage.onload = eventAssetsLoaded;
		}

		function eventAssetsLoaded() {
			canvasApp();
		}

		function canvasSupport() {
			return Modernizr.canvas;
		}

		function canvasApp() {
			if(!canvasSupport()) {
				return;
			}
			else {
				var theCanvas = document.getElementById("canvasOne");
				var context = theCanvas.getContext("2d");
			}

			var message = "your text";
			var fillOrStroke ="fill";
			var fontSize = "50";
			var fontFace = "serif";
			var fontWeight = "normal";
			var fontStyle = "normal";
			
			var textFillColor = "#ff0000";
			var textBaseline = "middle";
			var textAlign = "center";
			var textAlpha = 1;

			var shadowX = 1;
			var shadowY = 1;
			var shadowBlur = 1;
			var shadowColor = "#707070";

			var fillType = "colorFill";
			var textFillColor2 = "#000000";
			var pattern = new Image();
			pattern.src = "texture.jpg";

			var formElement = document.getElementById("textBox");
			formElement.addEventListener('keyup', textBoxChanged, false);

			formElement = document.getElementById("fillOrStroke");
			formElement.addEventListener('change', fillOrStrokeChanged, false);

			formElement = document.getElementById("textSize");
			formElement.addEventListener('change', textSizeChanged, false);

			formElement = document.getElementById("textFont");
			formElement.addEventListener('change', textFontChanged, false);
			
			formElement = document.getElementById("fontWeight");
			formElement.addEventListener('change', fontWeightChanged, false);
			
			formElement = document.getElementById("fontStyle");
			formElement.addEventListener('change', fontStyleChanged, false);

			formElement = document.getElementById("textFillColor");
			formElement.addEventListener('change', textFillColorChanged, false);

			formElement = document.getElementById("textBaseline");
			formElement.addEventListener('change', textBaselineChanged, false);

			formElement = document.getElementById("textAlign");
			formElement.addEventListener('change', textAlignChanged, false);
			
			formElement = document.getElementById("textAlpha");
			formElement.addEventListener('change', textAlphaChanged, false);

			formElement = document.getElementById("shadowX");
			formElement.addEventListener('change', shadowXChanged, false);

			formElement = document.getElementById("shadowY");
			formElement.addEventListener('change', shadowYChanged, false);

			formElement = document.getElementById("shadowBlur");
			formElement.addEventListener('change', shadowBlurChanged, false);

			formElement = document.getElementById("shadowColor");
			formElement.addEventListener('change', shadowColorChanged, false);

			formElement = document.getElementById("textFillColor2");
			formElement.addEventListener('change', textFillColor2Changed, false);

			formElement = document.getElementById("fillType");
			formElement.addEventListener('change', fillTypeChanged, false);

			formElement = document.getElementById("canvasWidth");
			formElement.addEventListener('change', canvasWidthChanged, false);

			formElement = document.getElementById("canvasHeight");
			formElement.addEventListener('change', canvasHeightChanged, false);

			formElement = document.getElementById("canvasStyleWidth");
			formElement.addEventListener("change", canvasStyleSizeChanged, false);

			formElement = document.getElementById("canvasStyleHeight");
			formElement.addEventListener("change", canvasStyleSizeChanged, false);

			formElement = document.getElementById("createImageData");
			formElement.addEventListener('click', createImageDataPressed, false);

			drawScreen();

			function drawScreen() {

				//Background
				context.globalAlpha = 1;

				context.shadowColor = "#707070";
				context.shadowOffsetX = 0;
				context.shadowOffsetY = 0;
				context.shadowBlur = 0;

				context.fillStyle = '#ffffaa';
				context.fillRect(0, 0, theCanvas.width, theCanvas.height);
				
				//Box
				context.strokeStyle = '#000000';
				context.strokeRect(5, 5, theCanvas.width - 10, theCanvas.height - 10);

				context.font = fontWeight + " " + fontStyle + " " + fontSize + "px " + fontFace;
				context.textBaseline = textBaseline;
				context.textAlign = textAlign;

				context.globalAlpha = textAlpha;

				context.shadowColor = shadowColor;
				context.shadowOffsetX = shadowX;
				context.shadowOffsetY = shadowY;
				context.shadowBlur = shadowBlur;

				var xPosition = (theCanvas.width/2);
				var yPosition = (theCanvas.height/2);
				
				var metrics = context.measureText(message);
				var textWidth = metrics.width;

				var tempColor;
				if(fillType == "colorFill") {
					tempColor = textFillColor;
				}
				else if(fillType == "linearGradient") {
					var gradient = context.createLinearGradient(xPositiontextWidth / 2, yPosition, textWidth, yPosition);
					gradient.addColorStop(0, textFillColor);
					gradient.addColorStop(.6, textFillColor2);
					tempColor = gradient;
				}
				else if(fillType == "radialGradient") {
					var gradient = context.createRadialGradient(xPosition, yPosition, fontSize, xPosition + textWidth, yPosition, 1);
					gradient.addColorStop(0, textFillColor);
					gradient.addColorStop(.6, textFillColor2);
					tempColor = gradient;
				}
				else if(fillType == "pattern") {
					var tempColor = context.createPattern(pattern, "repeat");
				}
				else {
					tempColor = textFillColor;
				}
				
				switch(fillOrStroke) {
					case "fill":
						context.fillStyle = tempColor;
						context.fillText(message, xPosition, yPosition);
						break;
					
					case "stroke":
						context.strokeStyle = tempColor;
						context.strokeText(message, xPosition, yPosition);
						break;
					
					case "both":					
						context.fillStyle = tempColor;
						context.fillText (message, xPosition, yPosition);
						context.strokeStyle = "#000000";
						context.strokeText(message, xPosition, yPosition);
						break;
				}
			}

			function textBoxChanged(evt) {
				var target = evt.target;
				message = target.value;				
				drawScreen();
			}

			function fillOrStrokeChanged(evt) {
				var target = evt.target;
				fillOrStroke = target.value;				
				drawScreen();
			}

			function textSizeChanged(evt) {
				var target = evt.target;
				fontSize = target.value;
				drawScreen();
			}

			function textFontChanged(evt) {
				var target = evt.target;
				fontFace = target.value;
				drawScreen();
			}
			
			function fontWeightChanged(evt) {
				var target = evt.target;
				fontWeight = target.value;
				drawScreen();
			}
			
			function fontStyleChanged(evt) {
				var target = evt.target;
				fontStyle = target.value;
				drawScreen();
			}

			function textFillColorChanged(evt) {
				var target = evt.target;
				textFillColor = "#" + target.value;
				drawScreen();
			}

			function textBaselineChanged(evt) {
				var target = evt.target;
				textBaseline = target.value;
				drawScreen();
			}
			
			function textAlignChanged(evt) {
				var target = evt.target;
				textAlign = target.value;
				drawScreen();
			}

			function textAlphaChanged(evt) {
				var target = evt.target;
				textAlpha = (target.value);
				drawScreen();
			}

			function shadowXChanged(evt) {
				var target = evt.target;
				shadowX = target.value;
				drawScreen();
			}

			function shadowYChanged(evt) {
				var target = evt.target;
				shadowY = target.value;
				drawScreen();
			}

			function shadowBlurChanged(evt) {
				var target = evt.target;
				shadowBlur = target.value;
				drawScreen();
			}

			function shadowColorChanged(evt) {
				var target = evt.target;
				shadowColor = "#" + target.value;
				drawScreen();
			}

			function textFillColor2Changed(evt) {
				var target = evt.target;
				textFillColor2 = "#" + target.value;
				drawScreen();
			}

			function fillTypeChanged(evt) {
				var target = evt.target;
				fillType = target.value;
				drawScreen();
			}

			function canvasWidthChanged(evt) {
				var target = evt.target;
				theCanvas.width = target.value;
				drawScreen();
			}

			function canvasHeightChanged(evt) {
				var target = evt.target;
				theCanvas.height = target.value;
				drawScreen();
			}

			function canvasStyleSizeChanged(evt) {
				var styleWidth = document.getElementById("canvasStyleWidth");
				var styleHeight = document.getElementById("canvasStyleHeight");
				var styleValue = "width:" + styleWidth.value + "px; height:" + styleHeight.value + "px;";
				theCanvas.setAttribute("style", styleValue );
				drawScreen();
			}

			function createImageDataPressed(evt) {
				var imageDataDisplay = document.getElementById('imageDataDisplay');
				imageDataDisplay.value = theCanvas.toDataURL();
				window.open(imageDataDisplay.value, "canvasImage", "left=0,top=0,width=" + theCanvas.width + ",height=" + theCanvas.height + ",toolbar=0,resizable=0");
			}
		}

	</script>

</head>
<body>
	
	<div class="page-container">

		<canvas id="canvasOne" width="500" height="500">
			Your browser does not support HTML5 Canvas.
		</canvas>

		<div class="wrapper">
			<form>
				<span class="label">Text:</span><input id="textBox" placeholder="your text"/>
			</form>
			
			
			<span class="label">Fill or Stroke:</span>
			<select id = "fillOrStroke">
				<option value = "fill">fill</option>
				<option value = "stroke">stroke</option>
				<option value = "both">both</option>
			</select>
			<br>

			<span class="label">Text font:</span>
			<select id="fontStyle">
				<option value="normal">normal</option>
				<option value="italic">italic</option>
				<option value="oblique">oblique</option>
			</select>
			<br>

			<span class="label">Font Weight:</span>
			<select id="fontWeight">
				<option value="normal">normal</option>
				<option value="bold">bold</option>
				<option value="bolder">bolder</option>
				<option value="lighter">lighter</option>
			</select>
			<br>

			<span class="label">Font Style:</span>
			<select id="textFont">
				<option value="serif">serif</option>
				<option value="sans-serif">sans-serif</option>
				<option value="cursive">cursive</option>
				<option value="fantasy">fantasy</option>
				<option value="monospace">monospace</option>
			</select>
			<br>
			
			<span class="label">Text Size:</span>
			<input type="range" id="textSize" min="0" max="200" step="1" value="50" />
			<br>
			
			<span class="label">Fill Type:</span>
			<select id="fillType">
				<option value="colorFill">Color Fill</option>
				<option value="linearGradient">Linear Gradient</option>
				<option value="radialGradient">Radial Gradient</option>
				<option value="pattern">pattern</option>
			</select>
			<br>

			<span class="label">Text Color:</span>
			<input class="color" id="textFillColor" value="FF0000" />
			<br>
			
			<span class="label">Text Color 2:</span>
			<input class="color" id="textFillColor2" value ="000000" />
			<br>

			<span class="label">Text Baseline:</span>
			<select id="textBaseline">
				<option value="middle">middle</option>
				<option value="top">top</option>
				<option value="hanging">hanging</option>
				<option value="alphabetic">alphabetic</option>
				<option value="ideographic">ideographic</option>
				<option value="bottom">bottom</option>
			</select>
			<br>
			
			<span class="label">Text Align:</span>
			<select id="textAlign">
				<option value="center">center</option>
				<option value="start">start</option>
				<option value="end">end</option>
				<option value="left">left</option>
				<option value="right">right</option>
			</select>
		</div>
		
		<div class="wrapper">
			<span class="label">Alpha:</span><input type="range" id="textAlpha" min="0.0" max="1.0" step="0.01" value="1.0" />
			<br>

			<span class="label">Shadow X:</span><input type="range" id="shadowX" min="−100" max="100" step="1" value="1" />
			<br>
			<span class="label">Shadow Y:</span><input type="range" id="shadowY" min="−100" max="100" step="1"	value="1" />
			<br>
			<span class="label">Shadow Blur:</span><input type="range" id="shadowBlur" min="1" max="100" step="1"	value="1" />
			<br>
			<span class="label">Shadow Color:</span><input class="color" id="shadowColor" value="707070" />
			<br>
			<span class="label">Canvas Width:</span> <input type="range" id="canvasWidth" min="0" max="1000" step="1" value="500" />
			<br>
			<span class="label">Canvas Height:</span> <input type="range" id="canvasHeight" min="0" max="1000"	step="1" value="300" />
			<br>
			<span class="label">Canvas Style Width:</span> <input type="range" id="canvasStyleWidth" min="0" max="1000" step="1" value="500" />
			<br>
			<span class="label">Canvas Style Height:</span> <input type="range" id="canvasStyleHeight" min="0" max="1000" step="1" value="300" />
			<br>
		</div>

		<div class="wrapper">
			<input type="button" id="createImageData" value="Create Image Data">
			<br>
			<br>
			<textarea id="imageDataDisplay" rows=10 cols=30></textarea>
		</div>

	</div>

</body>
</html>